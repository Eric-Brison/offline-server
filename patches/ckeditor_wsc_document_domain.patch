diff -urN ckeditor.orig/_source/plugins/wsc/plugin.js ckeditor/_source/plugins/wsc/plugin.js
--- a/chrome/ckeditor/content/ckeditor/_source/plugins/wsc/plugin.js	2011-05-09 16:58:44.000000000 +0200
+++ b/chrome/ckeditor/content/ckeditor/_source/plugins/wsc/plugin.js	2011-06-01 09:10:15.000000000 +0200
@@ -18,7 +18,7 @@
 		var command = editor.addCommand( commandName, new CKEDITOR.dialogCommand( commandName ) );
 
 		// SpellChecker doesn't work in Opera and with custom domain
-		command.modes = { wysiwyg : ( !CKEDITOR.env.opera && !CKEDITOR.env.air && document.domain == window.location.hostname ) };
+		command.modes = { wysiwyg : ( !CKEDITOR.env.opera && !CKEDITOR.env.air && CKEDITOR.env.isCustomDomain() && document.domain == window.location.hostname ) };
 
 		editor.ui.addButton( 'SpellChecker',
 			{
diff -urN ckeditor.orig/ckeditor.js ckeditor/ckeditor.js
--- a/chrome/ckeditor/content/ckeditor/ckeditor.js	2011-05-09 16:58:44.000000000 +0200
+++ b/chrome/ckeditor/content/ckeditor/ckeditor.js	2011-06-01 09:18:45.000000000 +0200
@@ -97,7 +97,7 @@
 else if(b.webkit)W.$.body.parentNode.contentEditable=Z;else W.$.designMode=Z?'off':'on';},0);Z&&b.gecko&&e.setTimeout(A,0,null,C);V=C.window=new d.window(V);W=C.document=new g(W);Z&&W.on('dblclick',function(af){var ag=af.data.getTarget(),ah={element:ag,dialog:''};C.fire('doubleclick',ah);ah.dialog&&C.openDialog(ah.dialog);});c&&W.on('click',function(af){var ag=af.data.getTarget();if(ag.is('input')){var ah=ag.getAttribute('type');if(ah=='submit'||ah=='reset')af.data.preventDefault();}});if(!(c||b.opera))W.on('mousedown',function(af){var ag=af.data.getTarget();if(ag.is('img','hr','input','textarea','select'))C.getSelection().selectElement(ag);});if(b.gecko)W.on('mouseup',function(af){if(af.data.$.button==2){var ag=af.data.getTarget();if(!ag.getOuterHtml().replace(m,'')){var ah=new d.range(W);ah.moveToElementEditStart(ag);ah.select(true);}}});W.on('click',function(af){af=af.data;if(af.getTarget().is('a')&&af.$.button!=2)af.preventDefault();});if(b.webkit){W.on('mousedown',function(){ac=1;});W.on('click',function(af){if(af.data.getTarget().is('input','select'))af.data.preventDefault();});W.on('mouseup',function(af){if(af.data.getTarget().is('input','textarea'))af.data.preventDefault();});}if(Z&&c&&W.$.compatMode=='CSS1Compat'||b.gecko||b.opera){var aa=W.getDocumentElement();aa.on('mousedown',function(af){if(af.data.getTarget().equals(aa)){if(b.gecko&&b.version>=10900)J();K.focus();}});}var ab=c?M:V;ab.on('blur',function(){C.focusManager.blur();});var ac;ab.on('focus',function(){var af=C.document;if(Z&&b.gecko&&b.version>=10900)J();else if(b.opera)af.getBody().focus();else if(b.webkit)if(!ac){C.document.getDocumentElement().focus();ac=1;}C.focusManager.focus();});var ad=C.keystrokeHandler;ad.blockedKeystrokes[8]=!Z;ad.attach(W);if(c){W.getDocumentElement().addClass(W.$.compatMode);Z&&W.on('keydown',function(af){var ag=af.data.getKeystroke();if(ag in {8:1,46:1}){var ah=C.getSelection(),ai=ah.getSelectedElement();if(ai){C.fire('saveSnapshot');var aj=ah.getRanges()[0].createBookmark();ai.remove();ah.selectBookmarks([aj]);C.fire('saveSnapshot');af.data.preventDefault();}}});if(W.$.compatMode=='CSS1Compat'){var ae={33:1,34:1};W.on('keydown',function(af){if(af.data.getKeystroke() in ae)setTimeout(function(){C.getSelection().scrollIntoView();},0);});}C.config.enterMode!=1&&W.on('selectionchange',function(){var af=W.getBody(),ag=C.getSelection().getRanges()[0];if(af.getHtml().match(/^<p>&nbsp;<\/p>$/i)&&ag.startContainer.equals(af))setTimeout(function(){ag=C.getSelection().getRanges()[0];
 if(!ag.startContainer.equals('body')){af.getFirst().remove(1);ag.moveToElementEditEnd(af);ag.select(1);}},0);});}if(C.contextMenu)C.contextMenu.addTarget(W,C.config.browserContextMenuOnCtrl!==false);setTimeout(function(){C.fire('contentDom');if(Q){C.mode='wysiwyg';C.fire('mode');Q=false;}N=false;if(O){C.focus();O=false;}setTimeout(function(){C.fire('dataReady');},0);try{C.document.$.execCommand('enableInlineTableEditing',false,!C.config.disableNativeTableHandles);}catch(af){}if(C.config.disableObjectResizing)try{C.document.$.execCommand('enableObjectResizing',false,false);}catch(ag){C.document.getBody().on(c?'resizestart':'resize',function(ah){ah.data.preventDefault();});}if(c)setTimeout(function(){if(C.document){var ah=C.document.$.body;ah.runtimeStyle.marginBottom='0px';ah.runtimeStyle.marginBottom='';}},1000);},0);};C.addMode('wysiwyg',{load:function(V,W,X){L=V;if(c&&b.quirks)V.setStyle('position','relative');C.mayBeDirty=true;Q=true;if(X)this.loadSnapshotData(W);else this.loadData(W);},loadData:function(V){N=true;C._.dataStore={id:1};var W=C.config,X=W.fullPage,Y=W.docType,Z='<style type="text/css" data-cke-temp="1">'+C._.styles.join('\n')+'</style>';!X&&(Z=e.buildStyleHtml(C.config.contentsCss)+Z);var aa=W.baseHref?'<base href="'+W.baseHref+'" data-cke-temp="1" />':'';if(X)V=V.replace(/<!DOCTYPE[^>]*>/i,function(ab){C.docType=Y=ab;return '';}).replace(/<\?xml\s[^\?]*\?>/i,function(ab){C.xmlDeclaration=ab;return '';});if(C.dataProcessor)V=C.dataProcessor.toHtml(V,D);if(X){if(!/<body[\s|>]/.test(V))V='<body>'+V;if(!/<html[\s|>]/.test(V))V='<html>'+V+'</html>';if(!/<head[\s|>]/.test(V))V=V.replace(/<html[^>]*>/,'$&<head><title></title></head>');else if(!/<title[\s|>]/.test(V))V=V.replace(/<head[^>]*>/,'$&<title></title>');aa&&(V=V.replace(/<head>/,'$&'+aa));V=V.replace(/<\/head\s*>/,Z+'$&');V=Y+V;}else V=W.docType+'<html dir="'+W.contentsLangDirection+'"'+' lang="'+(W.contentsLanguage||C.langCode)+'">'+'<head>'+'<title>'+E+'</title>'+aa+Z+'</head>'+'<body'+(W.bodyId?' id="'+W.bodyId+'"':'')+(W.bodyClass?' class="'+W.bodyClass+'"':'')+'>'+V+'</html>';if(b.gecko)V=V.replace(/<br \/>(?=\s*<\/(:?html|body)>)/,'$&<br type="_moz" />');V+=T;this.onDispose();S(V);},getData:function(){var V=C.config,W=V.fullPage,X=W&&C.docType,Y=W&&C.xmlDeclaration,Z=M.getFrameDocument(),aa=W?Z.getDocumentElement().getOuterHtml():Z.getBody().getHtml();if(b.gecko)aa=aa.replace(/<br>(?=\s*(:?$|<\/body>))/,'');if(C.dataProcessor)aa=C.dataProcessor.toDataFormat(aa,D);if(V.ignoreEmptyParagraph)aa=aa.replace(m,function(ab,ac){return ac;
 });if(Y)aa=Y+'\n'+aa;if(X)aa=X+'\n'+aa;return aa;},getSnapshotData:function(){return M.getFrameDocument().getBody().getHtml();},loadSnapshotData:function(V){M.getFrameDocument().getBody().setHtml(V);},onDispose:function(){if(!C.document)return;C.document.getDocumentElement().clearCustomData();C.document.getBody().clearCustomData();C.window.clearCustomData();C.document.clearCustomData();M.clearCustomData();M.remove();},unload:function(V){this.onDispose();C.window=C.document=M=L=O=null;C.fire('contentDomUnload');},focus:function(){var V=C.window;if(N)O=true;else if(b.opera&&C.document){var W=C.window.$.frameElement;W.blur(),W.focus();C.document.getBody().focus();C.selectionChange();}else if(!b.opera&&V){b.air?setTimeout(function(){V.focus();},0):V.focus();C.selectionChange();}}});C.on('insertHtml',p(q),null,null,20);C.on('insertElement',p(s),null,null,20);C.on('insertText',p(r),null,null,20);C.on('selectionChange',B,null,null,1);});var G;C.on('contentDom',function(){var L=C.document.getElementsByTag('title').getItem(0);L.data('cke-title',C.document.$.title);C.document.$.title=E;});C.on('readOnly',function(){if(C.mode=='wysiwyg'){var L=C.getMode();L.loadData(L.getData());}});if(a.document.$.documentMode>=8){C.addCss('html.CSS1Compat [contenteditable=false]{ min-height:0 !important;}');var H=[];for(var I in f.$removeEmpty)H.push('html.CSS1Compat '+I+'[contenteditable=false]');C.addCss(H.join(',')+'{ display:inline-block;}');}else if(b.gecko){C.addCss('html { height: 100% !important; }');C.addCss('img:-moz-broken { -moz-force-broken-image-icon : 1;\twidth : 24px; height : 24px; }');}C.addCss('html {\t_overflow-y: scroll; cursor: text;\t*cursor:auto;}');C.addCss('img, input, textarea { cursor: default;}');function J(L){if(C.readOnly)return;e.tryThese(function(){C.document.$.designMode='on';setTimeout(function(){C.document.$.designMode='off';if(a.currentInstance==C)C.document.getBody().focus();},50);},function(){C.document.$.designMode='off';var M=C.document.getBody();M.setAttribute('contentEditable',false);M.setAttribute('contentEditable',true);!L&&J(1);});};if(b.gecko||c||b.opera){var K;C.on('uiReady',function(){K=C.container.append(h.createFromHtml('<span tabindex="-1" style="position:absolute;" role="presentation"></span>'));K.on('focus',function(){C.focus();});C.focusGrabber=K;});C.on('destroy',function(){e.removeFunction(F);K.clearCustomData();delete C.focusGrabber;});}C.on('insertElement',function(L){var M=L.data;if(M.type==1&&(M.is('input')||M.is('textarea'))){if(!M.isReadOnly())M.data('cke-editable',M.hasAttribute('contenteditable')?'true':'1');
-M.setAttribute('contentEditable',false);}});}});if(b.gecko)(function(){var C=document.body;if(!C)window.addEventListener('load',arguments.callee,false);else{var D=C.getAttribute('onpageshow');C.setAttribute('onpageshow',(D?D+';':'')+'event.persisted && (function(){'+'var allInstances = CKEDITOR.instances, editor, doc;'+'for ( var i in allInstances )'+'{'+'\teditor = allInstances[ i ];'+'\tdoc = editor.document;'+'\tif ( doc )'+'\t{'+'\t\tdoc.$.designMode = "off";'+'\t\tdoc.$.designMode = "on";'+'\t}'+'}'+'})();');}})();})();i.disableObjectResizing=false;i.disableNativeTableHandles=true;i.disableNativeSpellChecker=true;i.ignoreEmptyParagraph=true;j.add('wsc',{requires:['dialog'],init:function(m){var n='checkspell',o=m.addCommand(n,new a.dialogCommand(n));o.modes={wysiwyg:!b.opera&&!b.air&&document.domain==window.location.hostname};m.ui.addButton('SpellChecker',{label:m.lang.spellCheck.toolbar,command:n});a.dialog.add(n,this.path+'dialogs/wsc.js');}});i.wsc_customerId=i.wsc_customerId||'1:ua3xw1-2XyGJ3-GWruD3-6OFNT1-oXcuB1-nR6Bp4-hgQHc-EcYng3-sdRXG3-NOfFk';i.wsc_customLoaderScript=i.wsc_customLoaderScript||null;a.DIALOG_RESIZE_NONE=0;a.DIALOG_RESIZE_WIDTH=1;a.DIALOG_RESIZE_HEIGHT=2;a.DIALOG_RESIZE_BOTH=3;(function(){var m=e.cssLength;function n(Q){return!!this._.tabs[Q][0].$.offsetHeight;};function o(){var U=this;var Q=U._.currentTabId,R=U._.tabIdList.length,S=e.indexOf(U._.tabIdList,Q)+R;for(var T=S-1;T>S-R;T--){if(n.call(U,U._.tabIdList[T%R]))return U._.tabIdList[T%R];}return null;};function p(){var U=this;var Q=U._.currentTabId,R=U._.tabIdList.length,S=e.indexOf(U._.tabIdList,Q);for(var T=S+1;T<S+R;T++){if(n.call(U,U._.tabIdList[T%R]))return U._.tabIdList[T%R];}return null;};function q(Q,R){var S=Q.$.getElementsByTagName('input');for(var T=0,U=S.length;T<U;T++){var V=new h(S[T]);if(V.getAttribute('type').toLowerCase()=='text')if(R){V.setAttribute('value',V.getCustomData('fake_value')||'');V.removeCustomData('fake_value');}else{V.setCustomData('fake_value',V.getAttribute('value'));V.setAttribute('value','');}}};a.dialog=function(Q,R){var S=a.dialog._.dialogDefinitions[R],T=e.clone(s),U=Q.config.dialog_buttonsOrder||'OS',V=Q.lang.dir;if(U=='OS'&&b.mac||U=='rtl'&&V=='ltr'||U=='ltr'&&V=='rtl')T.buttons.reverse();S=e.extend(S(Q),T);S=e.clone(S);S=new w(this,S);var W=a.document,X=Q.theme.buildDialog(Q);this._={editor:Q,element:X.element,name:R,contentSize:{width:0,height:0},size:{width:0,height:0},contents:{},buttons:{},accessKeyMap:{},tabs:{},tabIdList:[],currentTabId:null,currentTabIndex:null,pageCount:0,lastTab:null,tabBarMode:false,focusList:[],currentFocusIndex:0,hasFocus:false};
+M.setAttribute('contentEditable',false);}});}});if(b.gecko)(function(){var C=document.body;if(!C)window.addEventListener('load',arguments.callee,false);else{var D=C.getAttribute('onpageshow');C.setAttribute('onpageshow',(D?D+';':'')+'event.persisted && (function(){'+'var allInstances = CKEDITOR.instances, editor, doc;'+'for ( var i in allInstances )'+'{'+'\teditor = allInstances[ i ];'+'\tdoc = editor.document;'+'\tif ( doc )'+'\t{'+'\t\tdoc.$.designMode = "off";'+'\t\tdoc.$.designMode = "on";'+'\t}'+'}'+'})();');}})();})();i.disableObjectResizing=false;i.disableNativeTableHandles=true;i.disableNativeSpellChecker=true;i.ignoreEmptyParagraph=true;j.add('wsc',{requires:['dialog'],init:function(m){var n='checkspell',o=m.addCommand(n,new a.dialogCommand(n));o.modes={wysiwyg:!b.opera&&!b.air&&b.isCustomDomain()&&document.domain==window.location.hostname};m.ui.addButton('SpellChecker',{label:m.lang.spellCheck.toolbar,command:n});a.dialog.add(n,this.path+'dialogs/wsc.js');}});i.wsc_customerId=i.wsc_customerId||'1:ua3xw1-2XyGJ3-GWruD3-6OFNT1-oXcuB1-nR6Bp4-hgQHc-EcYng3-sdRXG3-NOfFk';i.wsc_customLoaderScript=i.wsc_customLoaderScript||null;a.DIALOG_RESIZE_NONE=0;a.DIALOG_RESIZE_WIDTH=1;a.DIALOG_RESIZE_HEIGHT=2;a.DIALOG_RESIZE_BOTH=3;(function(){var m=e.cssLength;function n(Q){return!!this._.tabs[Q][0].$.offsetHeight;};function o(){var U=this;var Q=U._.currentTabId,R=U._.tabIdList.length,S=e.indexOf(U._.tabIdList,Q)+R;for(var T=S-1;T>S-R;T--){if(n.call(U,U._.tabIdList[T%R]))return U._.tabIdList[T%R];}return null;};function p(){var U=this;var Q=U._.currentTabId,R=U._.tabIdList.length,S=e.indexOf(U._.tabIdList,Q);for(var T=S+1;T<S+R;T++){if(n.call(U,U._.tabIdList[T%R]))return U._.tabIdList[T%R];}return null;};function q(Q,R){var S=Q.$.getElementsByTagName('input');for(var T=0,U=S.length;T<U;T++){var V=new h(S[T]);if(V.getAttribute('type').toLowerCase()=='text')if(R){V.setAttribute('value',V.getCustomData('fake_value')||'');V.removeCustomData('fake_value');}else{V.setCustomData('fake_value',V.getAttribute('value'));V.setAttribute('value','');}}};a.dialog=function(Q,R){var S=a.dialog._.dialogDefinitions[R],T=e.clone(s),U=Q.config.dialog_buttonsOrder||'OS',V=Q.lang.dir;if(U=='OS'&&b.mac||U=='rtl'&&V=='ltr'||U=='ltr'&&V=='rtl')T.buttons.reverse();S=e.extend(S(Q),T);S=e.clone(S);S=new w(this,S);var W=a.document,X=Q.theme.buildDialog(Q);this._={editor:Q,element:X.element,name:R,contentSize:{width:0,height:0},size:{width:0,height:0},contents:{},buttons:{},accessKeyMap:{},tabs:{},tabIdList:[],currentTabId:null,currentTabIndex:null,pageCount:0,lastTab:null,tabBarMode:false,focusList:[],currentFocusIndex:0,hasFocus:false};
 this.parts=X.parts;e.setTimeout(function(){Q.fire('ariaWidget',this.parts.contents);},0,this);var Y={position:b.ie6Compat?'absolute':'fixed',top:0,visibility:'hidden'};Y[V=='rtl'?'right':'left']=0;this.parts.dialog.setStyles(Y);a.event.call(this);this.definition=S=a.fire('dialogDefinition',{name:R,definition:S},Q).definition;var Z={};if(!('removeDialogTabs' in Q._)&&Q.config.removeDialogTabs){var aa=Q.config.removeDialogTabs.split(';');for(i=0;i<aa.length;i++){var ab=aa[i].split(':');if(ab.length==2){var ac=ab[0];if(!Z[ac])Z[ac]=[];Z[ac].push(ab[1]);}}Q._.removeDialogTabs=Z;}if(Q._.removeDialogTabs&&(Z=Q._.removeDialogTabs[R]))for(i=0;i<Z.length;i++)S.removeContents(Z[i]);if(S.onLoad)this.on('load',S.onLoad);if(S.onShow)this.on('show',S.onShow);if(S.onHide)this.on('hide',S.onHide);if(S.onOk)this.on('ok',function(ap){Q.fire('saveSnapshot');setTimeout(function(){Q.fire('saveSnapshot');},0);if(S.onOk.call(this,ap)===false)ap.data.hide=false;});if(S.onCancel)this.on('cancel',function(ap){if(S.onCancel.call(this,ap)===false)ap.data.hide=false;});var ad=this,ae=function(ap){var aq=ad._.contents,ar=false;for(var as in aq)for(var at in aq[as]){ar=ap.call(this,aq[as][at]);if(ar)return;}};this.on('ok',function(ap){ae(function(aq){if(aq.validate){var ar=aq.validate(this);if(typeof ar=='string'){alert(ar);ar=false;}if(ar===false){if(aq.select)aq.select();else aq.focus();ap.data.hide=false;ap.stop();return true;}}});},this,null,0);this.on('cancel',function(ap){ae(function(aq){if(aq.isChanged()){if(!confirm(Q.lang.common.confirmCancel))ap.data.hide=false;return true;}});},this,null,0);this.parts.close.on('click',function(ap){if(this.fire('cancel',{hide:true}).hide!==false)this.hide();ap.data.preventDefault();},this);function af(){var ap=ad._.focusList;ap.sort(function(as,at){if(as.tabIndex!=at.tabIndex)return at.tabIndex-as.tabIndex;else return as.focusIndex-at.focusIndex;});var aq=ap.length;for(var ar=0;ar<aq;ar++)ap[ar].focusIndex=ar;};function ag(ap){var aq=ad._.focusList,ar=ap?1:-1;if(aq.length<1)return;var as=ad._.currentFocusIndex;try{aq[as].getInputElement().$.blur();}catch(av){}var at=(as+ar+aq.length)%aq.length,au=at;while(!aq[au].isFocusable()){au=(au+ar+aq.length)%aq.length;if(au==at)break;}aq[au].focus();if(aq[au].type=='text')aq[au].select();};this.changeFocus=ag;var ah;function ai(ap){var au=this;if(ad!=a.dialog._.currentTop)return;var aq=ap.data.getKeystroke(),ar=Q.lang.dir=='rtl';ah=0;if(aq==9||aq==2000+9){var as=aq==2000+9;if(ad._.tabBarMode){var at=as?o.call(ad):p.call(ad);
 ad.selectPage(at);ad._.tabs[at][0].focus();}else ag(!as);ah=1;}else if(aq==4000+121&&!ad._.tabBarMode&&ad.getPageCount()>1){ad._.tabBarMode=true;ad._.tabs[ad._.currentTabId][0].focus();ah=1;}else if((aq==37||aq==39)&&ad._.tabBarMode){at=aq==(ar?39:37)?o.call(ad):p.call(ad);ad.selectPage(at);ad._.tabs[at][0].focus();ah=1;}else if((aq==13||aq==32)&&ad._.tabBarMode){au.selectPage(au._.currentTabId);au._.tabBarMode=false;au._.currentFocusIndex=-1;ag(true);ah=1;}if(ah){ap.stop();ap.data.preventDefault();}};function aj(ap){ah&&ap.data.preventDefault();};var ak=this._.element;this.on('show',function(){ak.on('keydown',ai,this,null,0);if(b.opera||b.gecko&&b.mac)ak.on('keypress',aj,this);});this.on('hide',function(){ak.removeListener('keydown',ai);if(b.opera||b.gecko&&b.mac)ak.removeListener('keypress',aj);});this.on('iframeAdded',function(ap){var aq=new g(ap.data.iframe.$.contentWindow.document);aq.on('keydown',ai,this,null,0);});this.on('show',function(){var at=this;af();if(Q.config.dialog_startupFocusTab&&ad._.pageCount>1){ad._.tabBarMode=true;ad._.tabs[ad._.currentTabId][0].focus();}else if(!at._.hasFocus){at._.currentFocusIndex=-1;if(S.onFocus){var ap=S.onFocus.call(at);ap&&ap.focus();}else ag(true);if(at._.editor.mode=='wysiwyg'&&c){var aq=Q.document.$.selection,ar=aq.createRange();if(ar)if(ar.parentElement&&ar.parentElement().ownerDocument==Q.document.$||ar.item&&ar.item(0).ownerDocument==Q.document.$){var as=document.body.createTextRange();as.moveToElementText(at.getElement().getFirst().$);as.collapse(true);as.select();}}}},this,null,4294967295);if(b.ie6Compat)this.on('load',function(ap){var aq=this.getElement(),ar=aq.getFirst();ar.remove();ar.appendTo(aq);},this);y(this);z(this);new d.text(S.title,a.document).appendTo(this.parts.title);for(var al=0;al<S.contents.length;al++){var am=S.contents[al];am&&this.addPage(am);}this.parts.tabs.on('click',function(ap){var as=this;var aq=ap.data.getTarget();if(aq.hasClass('cke_dialog_tab')){var ar=aq.$.id;as.selectPage(ar.substring(4,ar.lastIndexOf('_')));if(as._.tabBarMode){as._.tabBarMode=false;as._.currentFocusIndex=-1;ag(true);}ap.data.preventDefault();}},this);var an=[],ao=a.dialog._.uiElementBuilders.hbox.build(this,{type:'hbox',className:'cke_dialog_footer_buttons',widths:[],children:S.buttons},an).getChild();this.parts.footer.setHtml(an.join(''));for(al=0;al<ao.length;al++)this._.buttons[ao[al].id]=ao[al];};function r(Q,R,S){this.element=R;this.focusIndex=S;this.tabIndex=0;this.isFocusable=function(){return!R.getAttribute('disabled')&&R.isVisible();
 };this.focus=function(){Q._.currentFocusIndex=this.focusIndex;this.element.focus();};R.on('keydown',function(T){if(T.data.getKeystroke() in {32:1,13:1})this.fire('click');});R.on('focus',function(){this.fire('mouseover');});R.on('blur',function(){this.fire('mouseout');});};a.dialog.prototype={destroy:function(){this.hide();this._.element.remove();},resize:(function(){return function(Q,R){var S=this;if(S._.contentSize&&S._.contentSize.width==Q&&S._.contentSize.height==R)return;a.dialog.fire('resize',{dialog:S,skin:S._.editor.skinName,width:Q,height:R},S._.editor);S.fire('resize',{skin:S._.editor.skinName,width:Q,height:R},S._.editor);if(S._.editor.lang.dir=='rtl'&&S._.position)S._.position.x=a.document.getWindow().getViewPaneSize().width-S._.contentSize.width-parseInt(S._.element.getFirst().getStyle('right'),10);S._.contentSize={width:Q,height:R};};})(),getSize:function(){var Q=this._.element.getFirst();return{width:Q.$.offsetWidth||0,height:Q.$.offsetHeight||0};},move:(function(){var Q;return function(R,S,T){var aa=this;var U=aa._.element.getFirst(),V=aa._.editor.lang.dir=='rtl';if(Q===undefined)Q=U.getComputedStyle('position')=='fixed';if(Q&&aa._.position&&aa._.position.x==R&&aa._.position.y==S)return;aa._.position={x:R,y:S};if(!Q){var W=a.document.getWindow().getScrollPosition();R+=W.x;S+=W.y;}if(V){var X=aa.getSize(),Y=a.document.getWindow().getViewPaneSize();R=Y.width-X.width-R;}var Z={top:(S>0?S:0)+'px'};Z[V?'right':'left']=(R>0?R:0)+'px';U.setStyles(Z);T&&(aa._.moved=1);};})(),getPosition:function(){return e.extend({},this._.position);},show:function(){var Q=this._.element,R=this.definition;if(!(Q.getParent()&&Q.getParent().equals(a.document.getBody())))Q.appendTo(a.document.getBody());else Q.setStyle('display','block');if(b.gecko&&b.version<10900){var S=this.parts.dialog;S.setStyle('position','absolute');setTimeout(function(){S.setStyle('position','fixed');},0);}this.resize(this._.contentSize&&this._.contentSize.width||R.width||R.minWidth,this._.contentSize&&this._.contentSize.height||R.height||R.minHeight);this.reset();this.selectPage(this.definition.contents[0].id);if(a.dialog._.currentZIndex===null)a.dialog._.currentZIndex=this._.editor.config.baseFloatZIndex;this._.element.getFirst().setStyle('z-index',a.dialog._.currentZIndex+=10);if(a.dialog._.currentTop===null){a.dialog._.currentTop=this;this._.parentDialog=null;E(this._.editor);Q.on('keydown',I);Q.on(b.opera?'keypress':'keyup',J);for(var T in {keyup:1,keydown:1,keypress:1})Q.on(T,P);}else{this._.parentDialog=a.dialog._.currentTop;
